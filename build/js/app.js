var my=my||{};$(function(){"use strict";var e,n,o=null,t={lat:44.9519177,lng:-93.2983446},r="Click on any category below to show types of places around Uptown Minneapolis.";ko.bindingHandlers.fadeVisible={init:function(e,n){var o=n();$(e).toggle(o)},update:function(e,n,o){var t=n(),r=o().fadeDuration||400;t?$(e).fadeIn(r):$(e).fadeOut(r)}},my.Venue=function(e){var n=this;n.ratingCheck=function(e){return e?e.toFixed(1):"N/A "},n.tipCheck=function(e){return e?e[0].text:""},n.itemCheck=function(e){return e?e:""},n.name=e.name,n.type=n.itemCheck(e.categories[0].name),n.lat=e.location.lat,n.lng=e.location.lng,n.center={lat:n.lat+.0119,lng:n.lng-.0119},n.rating=n.ratingCheck(e.rating),n.address=n.itemCheck(e.location.formattedAddress),n.tip=n.tipCheck(e.tips),n.phone=n.itemCheck(e.contact.formattedPhone),n.web=n.itemCheck(e.url)},my.contentStr=function(e){return"<div class=info><span class=info-name>"+e.name+"</span> <br /><span class=rating>"+e.rating+"/10</span> <br /><span class=address>"+e.address[0]+"<br />"+e.address[1]+'</span> <br /><a class=website href="'+e.web+'" target="_blank"> Website</a> <br /><a href="tel: +1-'+e.phone+'"><span class=phone>'+e.phone+"</span> <br /></div>"},my.toggleBounce=function(e){o&&o.setAnimation(null),o!==e?(e.setAnimation(google.maps.Animation.BOUNCE),o=e):o=null},my.baseUrl=function(){return"https://api.foursquare.com/v2/venues/explore?&section="},my.suffixUrl=function(){return"&client_id=DZIPLZYHXXYLCELWMS3N2DIO35PWEKTIZMABHZQ4VWKAU2JA&client_secret=1BFTWIS2O3IZLCDZNV2R2A4ITV0UYAVJV2MDBXIW3LWUOIOM&ll=44.9519177,-93.2983446&v=20130815&limit=20&day=any&time=any&radius=1500"},my.MapViewModel=function(){var a=[[],[],[],[],[],[],[]],s=ko.observableArray([]),i=ko.observableArray([]),c=ko.observableArray(["top places","food","drinks","shops","coffee","arts","outdoors"]),u=ko.observableArray(["build/imgopt/cat0.jpg","build/imgopt/cat1.jpg","build/imgopt/cat2.jpg","build/imgopt/cat3.jpg","build/imgopt/cat4.jpg"]),l=ko.observable("build/imgopt/searchError1.png"),p=ko.observable(),f=ko.observable("Sorry an error has occurred. Please Try again or look at these cute cats."),d=ko.observable("TOP PLACES"),g=ko.observable(r),m=ko.observable(!1),b=ko.observable(!1),v=ko.observable(""),y=ko.observable(""),h=ko.computed(function(){return my.baseUrl()+y()+my.suffixUrl()}),k=function(){M(),w()},w=function(){var o={zoom:14,center:new google.maps.LatLng(44.9519177,-93.2983446),disableDefaultUI:!0};e=new google.maps.Map($("#map-canvas")[0],o),n=new google.maps.InfoWindow({maxWidth:115}),(void 0===e||void 0===n)&&m(!0)},M=function(){c().forEach(function(e){y(e)})},C=function(){$.ajax({url:h(),dataType:"jsonp",success:function(e){function n(e){return void 0===e&&(e=0),e}var o,t,r=[];o=e.response.groups[0].items,o.sort(function(e,o){var t=n(e.venue.rating),r=n(o.venue.rating);return r>t?1:t>r?-1:0}),o.forEach(function(e){r.push(new my.Venue(e.venue))}),t="food"===e.response.query?1:"drinks"===e.response.query?2:"shops"===e.response.query?3:"coffee"===e.response.query?4:"arts"===e.response.query?5:"outdoors"===e.response.query?6:0,a[t]=r,0==t&&x(t)},timeout:5e3}).fail(function(){m(!0)})},L=function(n){p(n),U(n),W(n.myMarker),e.panTo(n.center)},A=function(e){var n;S(),s([]),d(e.toUpperCase()),"top places"===e?n=0:"food"===e?n=1:"drinks"===e?n=2:"shops"===e?n=3:"coffee"===e?n=4:"arts"===e?n=5:"outdoors"===e&&(n=6),x(n)},x=function(n){a[n].forEach(function(e){i.push(e),s.push(e)}),E(e),I(e),e.panTo(t)},V=function(){var e,n,o=v().toLowerCase();s().forEach(function(t){e=t.name.toLowerCase(),n=t.type.toLowerCase(),(-1!==e.search(o)||-1!==n.search(o))&&i.push(t)}),b(i().length<1?!0:!1)},E=function(){i().forEach(function(e){var t=new google.maps.LatLng(e.lat,e.lng),r=new google.maps.Marker({position:t});(void 0===t||void 0===r)&&m(!0),e.myMarker=r,google.maps.event.addListener(r,"click",function(){L(e)}),google.maps.event.addListener(n,"closeclick",function(){null!==o&&(o.setAnimation(null),o=null)})})},I=function(e){i().map(function(n){n.myMarker.setMap(e)})},U=function(e){var o=my.contentStr(e);n.setContent(o)},W=function(t){n.open(e,t),my.toggleBounce(t),null===o&&n.close()},S=function(){I(null),i([])};return v.subscribe(function(){S(),V(),I(e)}),y.subscribe(function(){C()}),{venueList:s,filterList:i,exploreList:c,exploreArray:a,currentVenue:p,exploreWord:y,searchWord:v,requestUrl:h,init:k,initGoogMap:w,getFourSquareService:C,setVenue:L,setAllMap:I,clearMap:S,canDisplayError:m,canDisplaySearch:b,setVenueBox:A,currentExplore:d,errorText:f,imgList:u,wrongSearch:l,exploreInstructions:g}}(),my.MapViewModel.init(),ko.applyBindings(my.MapViewModel)});